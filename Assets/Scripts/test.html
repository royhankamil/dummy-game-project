<!DOCTYPE html>
<html>
<head>
    <title>Unity WebGL Keplr Integration</title>
    <style>
        body { margin: 0; overflow: hidden; }
        #unityContainer { width: 100%; height: 100%; }
    </style>
    <script src="https://unpkg.com/@cosmjs/cosmwasm-stargate"></script>
    <script>
        var unityInstance;

        async function connectKeplr() {
            console.log("Checking for Keplr extension...");
            if (!window.getOfflineSigner || !window.keplr) {
                alert("Please install Keplr extension");
                console.error("Keplr extension not detected. Ensure it is installed and enabled.");
                return;
            }

            try {
                const chainId = "cosmoshub-4"; // Ganti dengan chain ID yang sesuai

                // Enable Keplr
                await window.keplr.enable(chainId);
                console.log("Keplr enabled successfully.");

                // Get the offline signer
                const offlineSigner = window.getOfflineSigner(chainId);

                // Get the account
                const accounts = await offlineSigner.getAccounts();
                console.log("Accounts retrieved:", accounts);

                // Kirim informasi akun ke Unity
                SendMessage('GameObjectName', 'OnKeplrAccountReceived', accounts[0].address);
            } catch (error) {
                console.error("Error enabling Keplr or retrieving accounts:", error);
                alert("Failed to connect to Keplr. Please check the console for more details.");
            }
        }

        function SendMessage(objectName, methodName, message) {
            if (unityInstance) {
                unityInstance.SendMessage(objectName, methodName, message);
            }
        }
    </script>
</head>
<body>
    <div id="unityContainer"></div>
    <script>
        var buildUrl = "Build";
        var loaderUrl = buildUrl + "/Build.loader.js";
        var config = {
            dataUrl: buildUrl + "/Build.data",
            frameworkUrl: buildUrl + "/Build.framework.js",
            codeUrl: buildUrl + "/Build.wasm",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "DefaultCompany",
            productName: "KeplrIntegration",
            productVersion: "0.1",
        };

        var script = document.createElement("script");
        script.src = loaderUrl;
        script.onload = () => createUnityInstance(document.querySelector("#unityContainer"), config, (progress) => {
            console.log(`Loading: ${progress * 100}%`);
        }).then((instance) => {
            unityInstance = instance;
        }).catch((message) => {
            alert(message);
        });

        document.body.appendChild(script);
    </script>
    <button onclick="connectKeplr()">Connect Keplr</button>
</body>
</html>
